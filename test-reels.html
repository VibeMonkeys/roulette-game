<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reel Test</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body { padding: 20px; background: #f0f0f0; }
        .test-container { max-width: 800px; margin: 0 auto; }
        .debug-info { background: #fff; padding: 10px; margin: 10px 0; border-radius: 5px; }
        button { margin: 5px; padding: 10px 20px; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Reel Test Page</h1>
        
        <div class="debug-info">
            <h3>Debug Controls</h3>
            <button onclick="testAllReels()">Test All Reels</button>
            <button onclick="testReel2Only()">Test Reel2 Only</button>
            <button onclick="resetAllReels()">Reset All Reels</button>
            <button onclick="debugReel2Visibility()">Debug Reel2 Visibility</button>
        </div>

        <div class="slot-machine" id="slotMachine">
            <div class="slot-frame">
                <div class="reel-container">
                    <div class="reel" id="reel1">
                        <div class="symbol-stream">
                            <div class="symbol">0</div><div class="symbol">1</div><div class="symbol">2</div><div class="symbol">3</div><div class="symbol">4</div><div class="symbol">5</div><div class="symbol">6</div>
                            <div class="symbol">0</div><div class="symbol">1</div><div class="symbol">2</div><div class="symbol">3</div><div class="symbol">4</div><div class="symbol">5</div><div class="symbol">6</div>
                            <div class="symbol">0</div><div class="symbol">1</div><div class="symbol">2</div><div class="symbol">3</div><div class="symbol">4</div><div class="symbol">5</div><div class="symbol">6</div>
                            <div class="symbol">0</div><div class="symbol">1</div><div class="symbol">2</div><div class="symbol">3</div><div class="symbol">4</div><div class="symbol">5</div><div class="symbol">6</div>
                            <div class="symbol">0</div><div class="symbol">1</div><div class="symbol">2</div><div class="symbol">3</div><div class="symbol">4</div><div class="symbol">5</div><div class="symbol">6</div>
                            <div class="symbol">0</div><div class="symbol">1</div><div class="symbol">2</div><div class="symbol">3</div><div class="symbol">4</div><div class="symbol">5</div><div class="symbol">6</div>
                        </div>
                    </div>
                    <div class="reel" id="reel2">
                        <div class="symbol-stream">
                            <div class="symbol">0</div><div class="symbol">1</div><div class="symbol">2</div><div class="symbol">3</div><div class="symbol">4</div><div class="symbol">5</div><div class="symbol">6</div>
                            <div class="symbol">0</div><div class="symbol">1</div><div class="symbol">2</div><div class="symbol">3</div><div class="symbol">4</div><div class="symbol">5</div><div class="symbol">6</div>
                            <div class="symbol">0</div><div class="symbol">1</div><div class="symbol">2</div><div class="symbol">3</div><div class="symbol">4</div><div class="symbol">5</div><div class="symbol">6</div>
                            <div class="symbol">0</div><div class="symbol">1</div><div class="symbol">2</div><div class="symbol">3</div><div class="symbol">4</div><div class="symbol">5</div><div class="symbol">6</div>
                            <div class="symbol">0</div><div class="symbol">1</div><div class="symbol">2</div><div class="symbol">3</div><div class="symbol">4</div><div class="symbol">5</div><div class="symbol">6</div>
                            <div class="symbol">0</div><div class="symbol">1</div><div class="symbol">2</div><div class="symbol">3</div><div class="symbol">4</div><div class="symbol">5</div><div class="symbol">6</div>
                        </div>
                    </div>
                    <div class="reel" id="reel3">
                        <div class="symbol-stream">
                            <div class="symbol">0</div><div class="symbol">1</div><div class="symbol">2</div><div class="symbol">3</div><div class="symbol">4</div><div class="symbol">5</div><div class="symbol">6</div>
                            <div class="symbol">0</div><div class="symbol">1</div><div class="symbol">2</div><div class="symbol">3</div><div class="symbol">4</div><div class="symbol">5</div><div class="symbol">6</div>
                            <div class="symbol">0</div><div class="symbol">1</div><div class="symbol">2</div><div class="symbol">3</div><div class="symbol">4</div><div class="symbol">5</div><div class="symbol">6</div>
                            <div class="symbol">0</div><div class="symbol">1</div><div class="symbol">2</div><div class="symbol">3</div><div class="symbol">4</div><div class="symbol">5</div><div class="symbol">6</div>
                            <div class="symbol">0</div><div class="symbol">1</div><div class="symbol">2</div><div class="symbol">3</div><div class="symbol">4</div><div class="symbol">5</div><div class="symbol">6</div>
                            <div class="symbol">0</div><div class="symbol">1</div><div class="symbol">2</div><div class="symbol">3</div><div class="symbol">4</div><div class="symbol">5</div><div class="symbol">6</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="debug-info" id="debugOutput">
            <h3>Debug Output</h3>
            <pre id="debugLog"></pre>
        </div>
    </div>

    <script>
        const allSymbols = ['0', '1', '2', '3', '4', '5', '6'];
        
        function log(message) {
            const debugLog = document.getElementById('debugLog');
            debugLog.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
            console.log(message);
        }

        // 화면 크기에 따른 심볼 높이와 뷰포트 위치 계산
        function getViewportSettings() {
            const screenWidth = window.innerWidth;
            
            if (screenWidth <= 360) {
                return { symbolHeight: 35, viewportTop: 35 };
            } else if (screenWidth <= 400) {
                return { symbolHeight: 40, viewportTop: 40 };
            } else if (screenWidth <= 768) {
                return { symbolHeight: 40, viewportTop: 40 };
            } else {
                return { symbolHeight: 50, viewportTop: 50 };
            }
        }
        
        // 순환 구조를 동적으로 생성하는 함수
        function generateCircularSymbols(targetSymbol, totalVisible = 40) {
            const targetIndex = allSymbols.indexOf(targetSymbol);
            if (targetIndex === -1) {
                log(`ERROR: Symbol '${targetSymbol}' not found in allSymbols array!`);
                return [];
            }

            const result = [];
            const centerPosition = 20; // 고정된 중앙 위치 (20번째 인덱스)

            // 중앙에 목표 심볼이 정확히 오도록 배치
            for (let i = 0; i < totalVisible; i++) {
                const offset = i - centerPosition;
                let symbolIndex = (targetIndex - offset + allSymbols.length * 10) % allSymbols.length;
                result.push(allSymbols[symbolIndex]);
            }

            return result;
        }
        
        // 릴의 심볼 스트림을 동적으로 업데이트하는 함수
        function updateReelSymbols(reel, targetSymbol) {
            const symbolStream = reel.querySelector('.symbol-stream');
            if (!symbolStream) {
                log(`ERROR: symbol-stream not found for reel: ${reel.id}`);
                return;
            }

            log(`Updating reel ${reel.id} with target symbol: ${targetSymbol}`);
            
            const circularSymbols = generateCircularSymbols(targetSymbol);
            log(`Generated ${circularSymbols.length} symbols. Center area: [${circularSymbols.slice(18, 23).join(', ')}]`);
            
            if (circularSymbols.length === 0) {
                log(`ERROR: No symbols generated for ${targetSymbol}!`);
                return;
            }
            
            symbolStream.innerHTML = '';

            circularSymbols.forEach((symbol, index) => {
                const symbolDiv = document.createElement('div');
                symbolDiv.className = 'symbol';
                symbolDiv.textContent = symbol;
                symbolStream.appendChild(symbolDiv);
            });
            
            log(`Added ${circularSymbols.length} symbols to ${reel.id}`);
        }
        
        function updateReelPosition(reel, symbol) {
            const symbolStream = reel.querySelector('.symbol-stream');
            if (!symbolStream) {
                log(`ERROR: symbol-stream not found for reel: ${reel.id}`);
                return;
            }
            
            log(`Updating position for reel ${reel.id} with symbol: ${symbol}`);
            updateReelSymbols(reel, symbol);
            
            const { symbolHeight, viewportTop } = getViewportSettings();
            const centerIndex = 20;
            const targetSymbolTop = centerIndex * symbolHeight;
            const offset = viewportTop - targetSymbolTop;
            
            log(`Position calculation: symbolHeight=${symbolHeight}, viewportTop=${viewportTop}, offset=${offset}`);
            
            symbolStream.style.transform = `translateZ(0) translateY(${offset}px)`;
            symbolStream.style.transition = 'none';
            
            log(`Applied transform: ${symbolStream.style.transform} to ${reel.id}`);
        }

        function testAllReels() {
            log('=== Testing All Reels ===');
            const reels = document.querySelectorAll('.reel');
            const testSymbols = ['2', '4', '6'];
            
            reels.forEach((reel, index) => {
                log(`Testing ${reel.id} with symbol ${testSymbols[index]}`);
                updateReelPosition(reel, testSymbols[index]);
            });
        }

        function testReel2Only() {
            log('=== Testing Reel2 Only ===');
            const reel2 = document.getElementById('reel2');
            if (reel2) {
                updateReelPosition(reel2, '3');
            } else {
                log('ERROR: reel2 element not found!');
            }
        }

        function resetAllReels() {
            log('=== Resetting All Reels ===');
            const reels = document.querySelectorAll('.reel');
            const initialSymbols = ['1', '3', '5'];
            
            reels.forEach((reel, index) => {
                log(`Resetting ${reel.id} with symbol ${initialSymbols[index]}`);
                updateReelPosition(reel, initialSymbols[index]);
            });
        }

        function debugReel2Visibility() {
            log('=== Debugging Reel2 Visibility ===');
            const reel2 = document.getElementById('reel2');
            const symbolStream = reel2?.querySelector('.symbol-stream');
            const symbols = symbolStream?.querySelectorAll('.symbol');
            
            log(`reel2 element: ${reel2 ? 'Found' : 'NOT FOUND'}`);
            log(`symbol-stream: ${symbolStream ? 'Found' : 'NOT FOUND'}`);
            log(`symbols count: ${symbols ? symbols.length : 'N/A'}`);
            
            if (reel2) {
                const reel2Style = window.getComputedStyle(reel2);
                log(`reel2 display: ${reel2Style.display}`);
                log(`reel2 visibility: ${reel2Style.visibility}`);
                log(`reel2 opacity: ${reel2Style.opacity}`);
                log(`reel2 transform: ${reel2Style.transform}`);
            }
            
            if (symbolStream) {
                const streamStyle = window.getComputedStyle(symbolStream);
                log(`symbol-stream display: ${streamStyle.display}`);
                log(`symbol-stream visibility: ${streamStyle.visibility}`);
                log(`symbol-stream opacity: ${streamStyle.opacity}`);
                log(`symbol-stream transform: ${streamStyle.transform}`);
            }
        }

        // Initialize on page load
        window.addEventListener('load', () => {
            log('Page loaded - running initial test');
            setTimeout(resetAllReels, 100);
        });
    </script>
</body>
</html>